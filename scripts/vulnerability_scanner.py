# scripts/vulnerability_scanner.py

import requests

def scan_package(package, version, ecosystem="PyPI"):
    """
    Query the OSV API for vulnerabilities affecting the given package version.
    Returns the JSON response (which includes vulnerability details) or an error.
    """
    url = "https://api.osv.dev/v1/query"
    payload = {
        "package": {"name": package, "ecosystem": ecosystem},
        "version": version
    }
    try:
        response = requests.post(url, json=payload)
        if response.status_code == 200:
            return response.json()
        else:
            return {"error": f"OSV API returned status {response.status_code}"}
    except Exception as e:
        return {"error": str(e)}
